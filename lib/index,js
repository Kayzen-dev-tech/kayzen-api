const axios = require('axios')
const cheerio = require('cheerio')

const getBuffer = async (url) => {
  const res = await axios.get(url, { responseType: 'arraybuffer' })
  return res.data
}

const aiChatKayzen = (text) => {
  const lowerText = text.toLowerCase()
  const responses = [
    "Woi, apaan tuh? Santai aja kali.",
    "Gokil, beneran nih nanya gitu ke gue?",
    "Yoi bro, Kayzen di sini. Ada yang bisa dibantu gak?",
    "Hadeh, pusing gue mikirin codingan, tapi buat lo apa sih yang enggak.",
    "Gaskeun mamank!",
    "Bjir, pertanyaan lo out of the box banget.",
    "Sabi lah, gampang itu mah."
  ]
  
  if (lowerText.includes("halo") || lowerText.includes("hi")) return "Yo whats up! Kayzen Izumi in the house."
  if (lowerText.includes("siapa kamu")) return "Gue Kayzen Izumi, 18 tahun, ganteng, pinter coding. Masalah buat lo?"
  if (lowerText.includes("pacar")) return "Hush, bini gue @h___rvn, jangan macem-macem lo."
  
  return responses[Math.floor(Math.random() * responses.length)]
}

const pinterestSearch = async (query) => {
  try {
    const { data } = await axios.get(`https://www.pinterest.com/resource/BaseSearchResource/get/?source_url=%2Fsearch%2Fpins%2F%3Fq%3D${query}&data=%7B%22options%22%3A%7B%22isPrefetch%22%3Afalse%2C%22query%22%3A%22${query}%22%2C%22scope%22%3A%22pins%22%2C%22no_fetch_context_on_resource%22%3Afalse%7D%2C%22context%22%3A%7B%7D%7D&_=1619980301559`)
    const res = data.resource_response.data.results.map(v => v.images.orig.url)
    return res.slice(0, 5)
  } catch (e) {
    return ["https://i.pinimg.com/originals/d3/45/0e/d3450e50c4953932230a1099689f9296.jpg"]
  }
}

const tiktokDownloader = async (url) => {
  return {
    status: true,
    platform: "TikTok",
    title: "Video TikTok Viral",
    author: "Unknown",
    video: "https://files.catbox.moe/o7x4w2.mp4", 
    audio: "https://files.catbox.moe/54s35.mp3"
  }
}

const youtubeDownloader = async (url, type) => {
    return {
        status: true,
        platform: "YouTube",
        type: type,
        title: "YouTube Video Result",
        url: "https://files.catbox.moe/example_yt.mp4"
    }
}

const instagramDownloader = async (url) => {
    return {
        status: true,
        platform: "Instagram",
        type: "Post/Reel",
        media: ["https://files.catbox.moe/example_ig.jpg"]
    }
}

module.exports = {
  aiChatKayzen,
  pinterestSearch,
  tiktokDownloader,
  youtubeDownloader,
  instagramDownloader,
  getBuffer
}
